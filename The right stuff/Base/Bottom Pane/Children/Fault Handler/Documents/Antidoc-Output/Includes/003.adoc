== Fault Handler.lvclass

*Responsibility:*

+++This tool leverages a fault event generated at the [Engine] parent level.  +++
+++This fault event reference is passed to all children classes and guarantees that any fault generated by any child is processed here.  +++

+++The tool reads any generated fault event, determines whether it is a warning or failure, and forces the [Base] GUI to display the fault front end on the bottom of the Main UI.  Errors and warnings are logged into application directories for fault metrics and analytics based on user error or software error.  +++

+++The tool allows users to clear fault and warning conditions, but will re-display if the fault condition has not been resolved.  +++

+++Additionally, the fault tool instructs the main user interface to set its status to Error or Warning as required.  It is the responsibility of the base software to manage responses to these instructions.  Fault Handler is built as a stand-separate packed library so that the source is protected and locked. +++


*Version:* 1.0.0.9

[plantuml, format="svg", align="center"]
....
@startuml
set namespaceSeparator :
skinparam ClassBackgroundColor #FFFFFF
skinparam ClassBorderColor #555555
skinparam ClassFontColor #000000
skinparam ClassHeaderBackgroundColor #808080

skinparam top to bottom direction
class "Fault Handler.lvlib:Fault Handler" {
{field} -Active Alarms : kLVObjMCListbox
{field} -Active Warnings : kLVObjMCListbox
{field} -Faults Tab : kLVObjTabArrayTabControl
{field} -Alarm Log : kLVObjString
{field} -Warning Log : kLVObjString
{field} -Alarm Report : NoType
{field} -Warning Report : NoType
{field} -Error State : Enum U16
{field} -Automation : NoType
{static} {method} +Add Automation reference()
{static} {method} -Clear Errors()
{static} {method} -Log Error Data()
{static} {method} -Refresh Alarms()
{static} {method} -Determine State()
{static} {method} -Open Logs()
{static} {method} -Terminate Automation()
{static} {method} -Refresh Display()
{static} {method} -Send Toggle Display()
{static} {method} -Update System State()
{static} {method} -Clear Warnings()
{static} {method} -Log Warning Data()
{static} {method} -Refresh Warnings()
{static} {method} -Post Launch Init()
{method} #Actor Core()

}
"Bottom Panel.lvlibp:Bottom" <|-- "Fault Handler.lvlib:Fault Handler"



@enduml
....

.Functions
[cols="<.<4d,<.<8a,<.<12d,<.<1a,<.<1a,<.<1a", %autowidth, frame=all, grid=all, stripes=none]
|===
|Name |Connector pane |Description |S. |R. |I.

|Add Automation reference
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Add_Automation_reference.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Add Automation reference.vi]
|+++<b>Add Automation Reference</b>+++

+++This routine take variant data (expected to be a TestStand Sequence Context reference) and writes the reference to private data.+++

|image:empty.png[empty.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Actor Core
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Actor_Core.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Actor Core.vi]
|+++	<b>Bottom Panel</b> actor is an abstraction that provides the actor framework panel size definitions.+++

+++<b>Fault Handler</b> This override implements the fault monitor software.  +++

+++<b> Events </b>+++

+++1. Waits for a fault event to be triggered (Events generated by <b>Engine:Check For Errors</b> called consistently through the software. When an event is triggered, the software calls <b> Process Warning</b> or <b>Process Error</b> based on the Status bit of the error cluster.+++

+++2. Monitors the Automation Reference Event (generated by <b>Engine:Send Automation Reference</b>) if a reference is provided, the software stores the reference in to private data so the fault handler has the capability of generating faults on the automated software.+++

+++<b>User Events</b>+++

+++1. After warnings and faults are dealt with, the fault records are cleared by operator intervention clicking clear alarms or clear warnings.  +++

+++2. The operator can also trigger a hide faults panel action which calls <b>Send Toggle Display</b> routine+++

|image:scope-protected.png[scope-protected.png]
|image:reentrancy-shared.png[reentrancy-shared.png]
|image:empty.png[empty.png]

|Read Active Alarms
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Active_Alarms.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Active Alarms.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Write Active Alarms
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Write_Active_Alarms.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Write Active Alarms.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Read Active Warnings
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Active_Warnings.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Active Warnings.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Write Active Warnings
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Write_Active_Warnings.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Write Active Warnings.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Read Alarm Log
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Alarm_Log.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Alarm Log.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Write Alarm Log
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Write_Alarm_Log.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Write Alarm Log.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Read Error State
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Error_State.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Error State.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Read Faults Tab
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Faults_Tab.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Faults Tab.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Write Faults Tab
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Write_Faults_Tab.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Write Faults Tab.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Read Warning Log
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Warning_Log.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Warning Log.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Write Warning Log
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Write_Warning_Log.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Write Warning Log.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:reentrancy-preallocated.png[reentrancy-preallocated.png]
|image:inlined.png[inlined.png]

|Clear Errors
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Clear_Errors.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Clear Errors.vi]
|+++Clear all errors in the active errors record, then it will call <b>Refresh Display</b>+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Log Error Data
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Log_Error_Data.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Log Error Data.vi]
|+++This routine is only called when a unique error is generated by the fault handler.+++

+++The error record (generated by the caller) is +++

+++     1. Pre-pended with a timestamp of the error occurence+++

+++     2. Written to the end of the error report file+++

+++     3. Appended to the end of the error log indicator on the fault monitor.+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Read Error Log Data
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Error_Log_Data.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Error Log Data.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Refresh Alarms
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Refresh_Alarms.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Refresh Alarms.vi]
|+++Called when error data is provided. +++
+++This routine checks the active error data to confirm if the error is already active:  +++

+++<b>Error Already Active</b>+++
+++The routine skips all additional steps and calls <b>Refresh Display</b>+++

+++<b>Error Not Active</b>+++
+++The Error is added to the active error list and constructs an error log record+++
+++The log record is written to the error log output file and appended to the Error history indicator+++
+++The routine calls <b>Refresh Display</b>+++
+++The routine calls <b>Terminate Automation</b>+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Determine State
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Determine_State.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Determine State.vi]
|+++This routine inspects active alarm and active warning records and prioritizes a status update based on the state of the system:+++

+++<b>No Fault Present</b>+++
+++Nominal Flag == <b>TRUE</b>+++
+++Error State == <b>Previous</b>+++

+++<b>Error Present</b>+++
+++Nominal Flag == <b>FALSE</b>+++
+++Error State == <b>Error</b>+++

+++<b>Warning Present</b>+++
+++Nominal Flag == <b>FALSE</b>+++
+++Error State == <b>Warning</b>+++

+++<b>Error & Warning Fault Present</b>+++
+++Nominal Flag == <b>FALSE</b>+++
+++Error State == <b>Error</b>+++

+++ +++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Open Logs
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Open_Logs.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Open Logs.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Terminate Automation
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Terminate_Automation.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Terminate Automation.vi]
|+++This routine can only be called when an error is active, automation  is running, and the fault monitor has a reference to the automated software sequence context.  +++

+++If all these conditions are met, the software transmits a terminate execution command to the automated software.+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Refresh Display
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Refresh_Display.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Refresh Display.vi]
|+++This routine uses the error and system state to determine if there is a state transition and if so, how to act on the state transition.+++

+++If only a warning is present, the software makes the entire panel Yellow+++
+++If no error is present, the software makes the entire panel the default color.+++
+++If an error is present, the software makes the entire panel Red+++
+++      Transmits a toggle component display == TRUE command (showing the display)+++

+++Finally the software calls <b>Update System State</b>+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Send Toggle Display
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Send_Toggle_Display.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Send Toggle Display.vi]
|+++This routine transmits the toggle display command implemented at the <b>Main UI</b> level.+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Update System State
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Update_System_State.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Update System State.vi]
|+++This routine inspects the state data and transmits an update state command to transition from no fault, or active fault states to a warning, error, or the previous state.+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Clear Warnings
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Clear_Warnings.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Clear Warnings.vi]
|+++Clear all warnings in the active warnings record, then it will call <b>Refresh Display</b>+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Log Warning Data
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Log_Warning_Data.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Log Warning Data.vi]
|+++This routine is only called when a unique warning is generated by the fault handler.+++

+++The warning record (generated by the caller) is +++

+++     1. Pre-pended with a timestamp of the error occurence+++

+++     2. Written to the end of the warning report file+++

+++     3. Appended to the end of the warning log indicator on the fault monitor.+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Read Warning Log Data
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Read_Warning_Log_Data.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Read Warning Log Data.vi]
|No description found (add content in vi description)
|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Refresh Warnings
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Refresh_Warnings.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Refresh Warnings.vi]
|+++Called when warning data is provided. +++
+++This routine checks the active warning data to confirm if the warning is already active:  +++

+++<b>Warning Already Active</b>+++
+++The routine skips all additional steps and calls <b>Refresh Display</b>+++

+++<b>Warning Not Active</b>+++
+++The warning is added to the active warning list and constructs a warning log record+++
+++The log record is written to the warning log output file and appended to the warning history indicator+++
+++The routine calls <b>Refresh Display</b>+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]

|Post Launch Init
|image:Fault_Handler.lvlib_Fault_Handler.lvclass_Post_Launch_Init.vi.png[Fault Handler.lvlib:Fault Handler.lvclass:Post Launch Init.vi]
|+++This routine reads the warnings and errors logs and updates the errors and warnings indicators on the front panel for a quick reference to the fault and warnings history.+++

+++Next the routine registers for events generated by the <b>Engine</b> Events references.+++

|image:scope-private.png[scope-private.png]
|image:empty.png[empty.png]
|image:empty.png[empty.png]
|===

**S**cope: image:scope-protected.png[] -> Protected | image:scope-community.png[] -> Community | image:scope-private.png[] -> Private

**R**eentrancy: image:reentrancy-preallocated.png[] -> Preallocated reentrancy | image:reentrancy-shared.png[] -> Shared reentrancy

**I**nlining: image:inlined.png[] -> Inlined
